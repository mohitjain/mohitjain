<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>Modules as application model in ruby on rails or refactor your code.</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/2012/12/modules-as-application-model-in-Ruby on Rails-or-refactor-your-code/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about.html">About</a></li>
        
            
        
            <li><a href="/contact.html">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="index">
    <div class="wrapper">
        <h1 class="right">Modules as application model in ruby on rails or refactor your code.</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/author.jpg" class="profileimage" alt="user">
    <h4>Mohit Jain</h4>
    <ul>
    	
        <li><a href="http://twitter.com/jainmohit27" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="http://facebook.com/jain.mohit27" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="http://github.com/mohitjain" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="http://codebeerstartups.com/feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>Rails Developer</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				optimization
          	
				performance
          	
				quick-solution
          	
				tips-and-tricks
          	
				utilities
          	
        </h2>
        <h1><a href="/2012/12/modules-as-application-model-in-Ruby on Rails-or-refactor-your-code/">Modules as application model in ruby on rails or refactor your code.</a></h1>
        <span>
            Posted by <a href="http://codebeerstartups.com" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-12-01">December 1, 2012</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">

        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					optimization
          		
					performance
          		
					quick-solution
          		
					tips-and-tricks
          		
					utilities
          		
            </h2>
            <h1 id="posttitle"><a href="#">Modules as application model in ruby on rails or refactor your code.</a></h1>
            <span>
                Posted by <a href="" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-12-01">December 1, 2012</time>.
            </span>
        </header>

        <section class="postbody">
            <p>Yesterday I was working on <a href="http://activeadmin.info/" title="Active Admin ">active_admin</a>. This is the first time I am using active admin in any of my project, I find it pretty awesome. If you never used it then <a href="http://railscasts.com/episodes/284-active-admin" title="Railcasts for Active admin">just it a try</a>. So while building dashboard for the active admin. I felt of the need to something like application_model ;) so that the place where I used modules as application model in ruby on rails
I was implementing <a href="http://railscasts.com/episodes/223-charts" title="HighCharts Railscasts">highcharts</a> in my application and I want to calculate Daily counts in last 30 days for most of the models likes users, products etc</p>

<h2 id="before">Before</h2>

<p>So I need this method for lots of models.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">daily_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
      <span class="n">counts</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Date(created_at)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
      <span class="p">(</span><span class="n">range</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">date</span><span class="o">|</span> <span class="n">counts</span><span class="o">[</span><span class="n">date</span><span class="o">]</span> <span class="o">||</span> <span class="p">}</span>
   <span class="c1"># A method which will return an array of daily new records of users (ie signups) in last 30 days (unless specified)</span>
 <span class="k">end</span></code></pre></div>

<p>Now Same functionality i need for product model and other models too. So instead of copy pasting this method in all the model, we can create a module and include that module in required models.</p>

<h2 id="after">After</h2>

<p>In lib directory, create a directory ie modules (or name it whatever you want to.)
Now create a file ie act_as_countable.rb there and paste this code.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">ActAsCountable</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">ClassMethods</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">ClassMethods</span>
    <span class="c1"># define all the class methods here.</span>
    <span class="c1"># this method returns total records array in last 30 days. Something like: [10, 40, 70, 90....]</span>
    <span class="k">def</span> <span class="nf">total_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
      <span class="n">total_records</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">counts</span> <span class="o">=</span>  <span class="nb">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Date(created_at)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
      <span class="p">(</span><span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">day</span><span class="o">|</span>
        <span class="n">total_records</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">total_records</span><span class="o">.</span><span class="n">sum</span>   <span class="p">(</span><span class="n">counts</span><span class="o">[</span><span class="n">day</span><span class="o">]</span> <span class="o">||</span> <span class="p">))</span>
      <span class="k">end</span>
      <span class="n">total_records</span>
    <span class="k">end</span>
  <span class="c1"># this method returns total daily news records array in last 30 days. Something like: [10, 2, 40, 15....]</span>
    <span class="k">def</span> <span class="nf">daily_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
      <span class="n">counts</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Date(created_at)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
      <span class="p">(</span><span class="n">range</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">date</span><span class="o">|</span> <span class="n">counts</span><span class="o">[</span><span class="n">date</span><span class="o">]</span> <span class="o">||</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Now In Models, where you need these methods. Just include them by:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">include</span> <span class="no">ActAsCountable</span></code></pre></div>

<p>Once includes you can call these methods as normal class methods like.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">User</span><span class="o">.</span><span class="n">total_records_counts_array_in_past_n_days</span>
<span class="no">Product</span><span class="o">.</span><span class="n">total_records_counts_array_in_past_n_days</span>
<span class="no">User</span><span class="o">.</span><span class="n">daily_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="mi">15</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
<span class="no">Product</span><span class="o">.</span><span class="n">daily_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="mi">15</span><span class="o">.</span><span class="n">days</span><span class="p">)</span></code></pre></div>

<p>If you want to define instance methods in you module. Just define them in the same module like this.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">ActAsCountable</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">ClassMethods</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">ClassMethods</span>
    <span class="k">def</span> <span class="nf">total_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
      <span class="n">total_records</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">counts</span> <span class="o">=</span>  <span class="nb">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Date(created_at)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
      <span class="p">(</span><span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">day</span><span class="o">|</span>
        <span class="n">total_records</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">total_records</span><span class="o">.</span><span class="n">sum</span>   <span class="p">(</span><span class="n">counts</span><span class="o">[</span><span class="n">day</span><span class="o">]</span> <span class="o">||</span> <span class="p">))</span>
      <span class="k">end</span>
      <span class="n">total_records</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">daily_records_counts_array_in_past_n_days</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="mi">30</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
      <span class="n">counts</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Date(created_at)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
      <span class="p">(</span><span class="n">range</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">date</span><span class="o">|</span> <span class="n">counts</span><span class="o">[</span><span class="n">date</span><span class="o">]</span> <span class="o">||</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">my_instance_method</span>
    <span class="c1"># this is my sample blank instance method</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Note: You need to add load these modules via specifying the path in application_controller.rb. Also you need to restart your application.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span>  <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">config</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/lib/modules/**&quot;</span><span class="o">]</span></code></pre></div>

<p>You can use module even to refactor the code. For example. Generally my user model has lot of methods related to fetch data from facebook, once user signs up. So create a module for those instance methods.</p>

        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=Modules as application model in ruby on rails or refactor your code.&url=http://codebeerstartups.com/2012/12/modules-as-application-model-in-Ruby on Rails-or-refactor-your-code/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://codebeerstartups.com/2012/12/modules-as-application-model-in-Ruby on Rails-or-refactor-your-code/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/author.jpg" class="author" alt="user">
            <div class="info">
                <h4>Mohit Jain</h4>
                <a href="http://codebeerstartups.com">http://codebeerstartups.com</a>
                <p>Rails Developer</p>
                <ul class="social">
       				
                    <li><a href="http://twitter.com/jainmohit27" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="http://facebook.com/jain.mohit27" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="http://github.com/mohitjain" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
					
					
                    <li><a href="https://plus.google.com/+MohitJain27" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
					
					
					
                    <li><a href="https://www.pinterest.com/mohitjain27/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/profile/view?id=40603170" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="http://codebeerstartups.com/feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>


        <div class="comments">
            <a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
            <div id="disqus_thread"></div>
            <div id="g-comments"></div>
        </div>

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about.html">About</a> &bull;
        
        	
        
        	<a href="/contact.html">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>