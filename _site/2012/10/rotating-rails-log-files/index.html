<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>Rotating Rails Log Files</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/2012/10/rotating-rails-log-files/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            <li><a href="/contact/">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="index">
    <div class="wrapper">
        <h1 class="right">Rotating Rails Log Files</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/author.jpg" class="profileimage" alt="user">
    <h4>Mohit Jain</h4>
    <ul>
    	
        <li><a href="http://twitter.com/jainmohit27" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="http://facebook.com/jain.mohit27" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="http://github.com/mohitjain" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="http://codebeerstartups.com/feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>Rails Developer</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				Performance
          	
				Logs
          	
				ruby-on-rails
          	
        </h2>
        <h1><a href="/2012/10/rotating-rails-log-files/">Rotating Rails Log Files</a></h1>
        <span>
            Posted by <a href="http://codebeerstartups.com" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-10-20">October 20, 2012</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">

        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					Performance
          		
					Logs
          		
					ruby-on-rails
          		
            </h2>
            <h1 id="posttitle"><a href="#">Rotating Rails Log Files</a></h1>
            <span>
                Posted by <a href="" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-10-20">October 20, 2012</time>.
            </span>
        </header>

        <section class="postbody">
            <h2 id="why-rotation-of-log-files-is-important">Why Rotation of log files is important.</h2>

<p>The idea behind log rotation is simple: make a back up of the current log file, continue logging into a new or cleared log file, and discard log files that are older than a certain date.
Your web server probably already rotates its own log files. For Apache, they are probably located in/etc/httpd/logs and they are probably rotated weekly. These logs store everything Apache does. Simple webserver stats and traffic analysis tools make use of these log files to show who visits a site when and what pages are viewed.
While it is possible to configure your Rails application to log to your Apache log files, I do not think it is a good practice. It’s much better to give each Rails application its own log file—it will be easier to find important Rails errors, it will keep your Apache logs cleaner and Rails is set up to keep its own logs by default. Fortunately, on a Linux server the built-in logrotate program will make the process super-easy. After the jump, I’ll walk you through the steps to get it set up.
Configuring logrotatelogrotate gets its configuration information from the file /etc/logrotate.conf. If you can’t find it, you can type locate logrotate.conf from the command line to see where it lives. Open up that file in a text editor (nano /etc/logrotate.conf will work) and append the following lines at the end:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Rotate Rails application logs</span>

<span class="sr">/path/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">applicaton</span><span class="o">/</span><span class="n">log</span><span class="o">/*</span><span class="p">.</span><span class="nf">log</span> <span class="p">{</span>
  <span class="n">daily</span>
  <span class="n">missingok</span>
  <span class="n">rotate</span> <span class="mi">7</span>
  <span class="n">compress</span>
  <span class="n">delaycompress</span>
  <span class="n">notifempty</span>
  <span class="n">copytruncate</span>
<span class="p">}</span></code></pre></figure>

<h2 id="heres-what-each-line-does">Here’s what each line does:</h2>

<h2 id="pathtoyourrailsapplicatonloglog-">/path/to/your/rails/applicaton/log/*.log –</h2>
<p>Use the full path to the log directory of your Rails application (symbolic links are acceptable too). “*.log” will rotate any file in the log directory with .log at the end. If you only want to rotate certain log files you can be more specific.</p>

<h2 id="daily">daily</h2>
<p>Rotates the log files every day. You could specify weekly or monthly instead.</p>

<h2 id="missingok">/missingok</h2>
<p>Don’t issue an error message if log files are missing.</p>

<h2 id="rotate-7">/rotate 7</h2>
<p>The maximum number of log files to keep. Once you have more than this number, the oldest file will be deleted. I set it to keep seven days worth but feel free to change this number.</p>

<h2 id="compress">/compress</h2>
<p>Compress old versions of log files to save space (uses gzip by default).</p>

<h2 id="delaycompress">/delaycompress</h2>
<p>Delays the compression until the next log rotation. It’s a minor point and probably not strictly necessary, but it makes sure that the log file is truly no longer active before compressing it.</p>

<h2 id="notifempty">/notifempty</h2>
<p>If the log file is empty, there’s no need to rotate it. You can remove this option if you want to rotate even blank log files; just keep in mind that you may erase a log file that has lots of information to make room for your blank log file.</p>

<h2 id="copytruncate">/copytruncate</h2>
<p>Makes a backup copy of the current log and then clears the log file for continued writing. The alternative is to use create which will perform the rotation by renaming the current file and then creating a new log file with the same name as the old file. I strongly recommend that you use copytruncate unless you know that you need create. The reason why is that Rails, FastCGI, Mongrel, etc. may still keep pointing to the old log file even though its name has changed and they may require restarting to locate the new log file. copytruncate avoids this by keeping the same file as the active file.</p>

<p>If you have more than one Rails application, you can repeat this code to rotate them all one-after-another. There other options you can specify, man logrotate will show you them all. I haven’t used them but the options to mail log files on creation or deletion look interesting. It is also possible to have rotate the logs once they get to a certain size instead of at a certain time.</p>

<h2 id="using-logrotate">Using logrotate</h2>

<p>To use the log rotation you just configured, you have two choices.</p>

<ol>
  <li>Wait for the next day (or whatever time period you specified). If you configured it correctly, rotation should occur automatically and without further commands.</li>
  <li>Run it immediately by typing /usr/sbin/logrotate -f /etc/logrotate.conf on the command line. (The -f is for “force it to run now.)</li>
</ol>

<p>That’s all there is to it! Now your log files won’t fill up to an unmanagable size yet you’ll still be able to go back and track any recent errors.</p>

        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=Rotating Rails Log Files&url=http://codebeerstartups.com/2012/10/rotating-rails-log-files/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://codebeerstartups.com/2012/10/rotating-rails-log-files/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/author.jpg" class="author" alt="user">
            <div class="info">
                <h4>Mohit Jain</h4>
                <a href="http://codebeerstartups.com">http://codebeerstartups.com</a>
                <p>Rails Developer</p>
                <ul class="social">
       				
                    <li><a href="http://twitter.com/jainmohit27" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="http://facebook.com/jain.mohit27" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="http://github.com/mohitjain" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
					
					
                    <li><a href="https://plus.google.com/+MohitJain27" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
					
					
					
                    <li><a href="https://www.pinterest.com/mohitjain27/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/profile/view?id=40603170" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="http://codebeerstartups.com/feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>


        <div class="comments">
            <a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
            <div id="disqus_thread"></div>
            <div id="g-comments"></div>
        </div>

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	<a href="/contact/">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>