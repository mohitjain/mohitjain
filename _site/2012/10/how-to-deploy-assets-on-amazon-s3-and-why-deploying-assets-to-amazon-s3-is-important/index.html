<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>How to deploy assets on Amazon S3 and why deploying assets to Amazon S3 is important.</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/2012/10/how-to-deploy-assets-on-amazon-s3-and-why-deploying-assets-to-amazon-s3-is-important/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            <li><a href="/contact/">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="index">
    <div class="wrapper">
        <h1 class="right">How to deploy assets on Amazon S3 and why deploying assets to Amazon S3 is important.</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/author.jpg" class="profileimage" alt="user">
    <h4>Mohit Jain</h4>
    <ul>
    	
        <li><a href="http://twitter.com/jainmohit27" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="http://facebook.com/jain.mohit27" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="http://github.com/mohitjain" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="http://codebeerstartups.com/feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>Rails Developer</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				Performance
          	
				ruby-on-rails
          	
        </h2>
        <h1><a href="/2012/10/how-to-deploy-assets-on-amazon-s3-and-why-deploying-assets-to-amazon-s3-is-important/">How to deploy assets on Amazon S3 and why deploying assets to Amazon S3 is important.</a></h1>
        <span>
            Posted by <a href="http://codebeerstartups.com" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-10-21">October 21, 2012</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">

        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					Performance
          		
					ruby-on-rails
          		
            </h2>
            <h1 id="posttitle"><a href="#">How to deploy assets on Amazon S3 and why deploying assets to Amazon S3 is important.</a></h1>
            <span>
                Posted by <a href="" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2012-10-21">October 21, 2012</time>.
            </span>
        </header>

        <section class="postbody">
            <p>I was working on my project <a href="http://www.kwaab.com/">Kwaab</a> and suddenly because of huge traffic (15-20 hits per second), site starts slowing down. Page load time was increased from 10 seconds to 40 seconds and sometimes even more than that. We tried to increased the server, still no major improvements. Here are some things we have already done:</p>

<ul>
  <li>Landing Page is cached</li>
  <li>2GB of Ram and only 800MB is used</li>
  <li>CPU utilisation is less than 40%</li>
  <li>User uploaded images are already coming from Amazon s3</li>
  <li>Use cache control and expiry headers</li>
  <li>Compresss images using smusher</li>
  <li>Compress js and cssâ€¦ and lot more basic things we should do..</li>
</ul>

<p>But still site is super damm slow, because issue was loading time for assets. As my assets were coming from linode itself and due to high traffic of the website, client was waiting for assets for like 15 seconds just for logo etc and that was slowing my website.</p>

<p>I got a life saver i.e. <a href="https://github.com/rumblelabs/asset_sync">asset_sync</a> a gem to deploy your assets on amazon bucket :)</p>

<h2 id="how-to-implement-deploying-assets-on-amazon-s3">How to implement deploying assets on amazon s3</h2>

<ul>
  <li>Install the gem:
If you want, you can put it within your :assets group in your Gemfile.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s2">"asset_sync"</span></code></pre></figure>

<ul>
  <li>Create a file asset_sync.yml in your cofig directory or checkout the inbuilt generator i.e</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">g</span> <span class="n">asset_sync</span><span class="ss">:install</span> <span class="o">--</span><span class="n">use</span><span class="o">-</span><span class="n">yml</span> <span class="o">--</span><span class="n">provider</span><span class="o">=</span><span class="no">AWS</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>which will generate a file in app/config/asset_sync.yml

Now I have this asset_sync.yml file, but you can configure it as per the docs of the gems.
</code></pre>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">staging:
  fog_provider: </span><span class="no">AWS</span>
  <span class="ss">aws_access_key_id: </span><span class="o">**********************</span>
  <span class="ss">aws_secret_access_key: </span><span class="o">**********************</span>
  <span class="ss">fog_directory: </span><span class="n">assetsstaging</span>
  <span class="ss">gzip_compression: </span><span class="s1">'true'</span>
  <span class="ss">existing_remote_files: </span><span class="n">keep</span>

<span class="ss">production:
  fog_provider: </span><span class="no">AWS</span>
  <span class="ss">aws_access_key_id: </span><span class="o">**********************</span>
  <span class="ss">aws_secret_access_key: </span><span class="o">**********************</span>
  <span class="ss">fog_directory: </span><span class="n">assetsproduction</span>
  <span class="ss">gzip_compression: </span><span class="s1">'true'</span>
  <span class="ss">existing_remote_files: </span><span class="n">keep</span></code></pre></figure>

<ul>
  <li>Place these lines of code in your production/staging environment file:</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">asset_sync_config_file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">,</span> <span class="s1">'config'</span><span class="p">,</span> <span class="s1">'asset_sync.yml'</span><span class="p">)</span>
  <span class="no">ASSETCONFIG</span> <span class="o">=</span> <span class="no">HashWithIndifferentAccess</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span><span class="no">IO</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">asset_sync_config_file</span><span class="p">)))[</span><span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="p">]</span>
  <span class="no">ASSETCONFIG</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span>
    <span class="no">ENV</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="nf">upcase</span><span class="p">]</span> <span class="o">||=</span> <span class="n">v</span>
  <span class="k">end</span></code></pre></figure>

<ul>
  <li>Down the above code. Place these lines of code which will tell rails to get the assets from here.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_controller</span><span class="p">.</span><span class="nf">asset_host</span> <span class="o">=</span> <span class="s2">"//</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'FOG_DIRECTORY'</span><span class="p">]</span><span class="si">}</span><span class="s2">.s3.amazonaws.com"</span></code></pre></figure>

<ul>
  <li>
    <p>Also make sure your production/staging environment files have:</p>

    <ul>
      <li>config.assets.digest is set to true.</li>
      <li>config.assets.enabled is set to true.</li>
    </ul>
  </li>
</ul>

<p>Thats it. Now just deploy your rails application and all the assets will be pushed to respective bucket on amazon :) and it solved my server issue to with a considerable amount. We made some more tweaks. I will post them soon.
<strong><em>PS: In my case I need to create that amazon bucket manually. You may need to do so.</em></strong></p>

        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=How to deploy assets on Amazon S3 and why deploying assets to Amazon S3 is important.&url=http://codebeerstartups.com/2012/10/how-to-deploy-assets-on-amazon-s3-and-why-deploying-assets-to-amazon-s3-is-important/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://codebeerstartups.com/2012/10/how-to-deploy-assets-on-amazon-s3-and-why-deploying-assets-to-amazon-s3-is-important/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/author.jpg" class="author" alt="user">
            <div class="info">
                <h4>Mohit Jain</h4>
                <a href="http://codebeerstartups.com">http://codebeerstartups.com</a>
                <p>Rails Developer</p>
                <ul class="social">
       				
                    <li><a href="http://twitter.com/jainmohit27" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="http://facebook.com/jain.mohit27" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="http://github.com/mohitjain" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
					
					
                    <li><a href="https://plus.google.com/+MohitJain27" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
					
					
					
                    <li><a href="https://www.pinterest.com/mohitjain27/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/profile/view?id=40603170" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="http://codebeerstartups.com/feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>


        <div class="comments">
            <a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
            <div id="disqus_thread"></div>
            <div id="g-comments"></div>
        </div>

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	<a href="/contact/">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>