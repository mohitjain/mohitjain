<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>Codebeerstartups</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/page23/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            <li><a href="/contact/">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="profile">
	
	<h4>Codebeerstartups</h4>
	<p>Every Dog has one Blog</p>
	<hr>
</div>

<section class="posts postindex wrapper">

	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					Performance 
					
					ruby-on-rails 
					
				</h2>
				<h1><a href="/2012/10/dont-use-time_ago_in_words/">Dont use time_ago_in_words</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-10-20">October 20, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>Rails provides a helper method time_ago_in_words to display the distance between one time and now, like “5 minute ago”, it’s very useful.</p>

<h2 id="before">Before</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">times_ago_in_words</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="nf">created_at</span><span class="p">)</span></code></pre></figure>

<p>It looks fine, but we have some room to improve.</p>

<ul>
  <li>Your servers have to calculate the time ago for each request, it wastes the cpu capability on server side, why not move the calculation to client side.</li>
  <li>If we calculate the time ago on server side, it gets difficult to cache the page. e.g. after you create a comment, the time ago of the comment shows “5 seconds ago”, if you cache the page, the time ago still show “5 second ago” after 3 minute (depends on your cache strategy).</li>
</ul>

<h2 id="refactor">Refactor</h2>

<p>The solution is to use browser script like javascript. On server side, what you need is to pass the created or updated time instead of calculated time ago, then the javascript will calculate the time ago on client side.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">abbr</span> <span class="k">class</span><span class="o">=</span><span class="s2">"timeago"</span> <span class="n">title</span><span class="o">=</span><span class="s2">"&lt;%= comment.created_at.getutc.iso8601 %&gt;"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= comment.created_at.to_s %&gt;
&lt;/abbr&gt;</span></code></pre></figure>

<p>Here is a javascript solution based on <a href="http://timeago.yarp.com/">jquery</a> , of course, you can use other time ago js library.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">"abbr.timeago"</span><span class="p">).</span><span class="nx">timeago</span><span class="p">();</span></code></pre></figure>

<p>Now, you save the server cpu capability and make your page easier to cache.</p>

   
					
				</div>
			</header>
		</article>
	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					Performance 
					
					ruby-on-rails 
					
				</h2>
				<h1><a href="/2012/10/always-add-db-index/">Always add DB index</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-10-20">October 20, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>Always add db index for foreign key, columns that need to be sorted, lookup fields and columns that are used in a GROUP BY.This can improve the performance for sql query. If you’re not sure which column need to index</p>

<h2 id="bad-smell">Bad Smell</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
   <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
      <span class="n">create_table</span> <span class="s2">"comments"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:content</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:post_id</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:user_id</span>
      <span class="k">end</span>
   <span class="k">end</span>

   <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
       <span class="n">drop_table</span> <span class="s2">"comments"</span>
   <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>By default, rails does not add indexes automatically for foreign key, you should add indexes by yourself.</p>

<h2 id="refactor">Refactor</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
   <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
      <span class="n">create_table</span> <span class="s2">"comments"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
          <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:content</span>
          <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:post_id</span>
          <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:user_id</span>
      <span class="k">end</span>

      <span class="n">add_index</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">:post_id</span>
      <span class="n">add_index</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">:user_id</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
    <span class="n">drop_table</span> <span class="s2">"comments"</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>This is a basic practice, follow it.</p>

<p>I recommend to use , which provide rake tasks to find missing indexes.</p>
   
					
				</div>
			</header>
		</article>
	

	<div class="pagination">
	
	
		<a href="/page22" class="smallbutton lightgray right"><span>Newer Posts</span><i class="fa fa-chevron-right"></i></a>
	
</div>

</section>

    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	<a href="/contact/">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>