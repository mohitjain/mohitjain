<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>How to implement action caching in ruby on rails with ajax enabled</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/2013/02/how-to-implement-action-caching-in-ruby-on-rails-with-ajax-enabled/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about.html">About</a></li>
        
            
        
            <li><a href="/contact.html">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="index">
    <div class="wrapper">
        <h1 class="right">How to implement action caching in ruby on rails with ajax enabled</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/author.jpg" class="profileimage" alt="user">
    <h4>Mohit Jain</h4>
    <ul>
    	
        <li><a href="http://twitter.com/jainmohit27" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="http://facebook.com/jain.mohit27" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="http://github.com/mohitjain" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="http://codebeerstartups.com/feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>Rails Developer</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				optimization
          	
				performance
          	
				quick-solution
          	
				tips-and-tricks
          	
        </h2>
        <h1><a href="/2013/02/how-to-implement-action-caching-in-ruby-on-rails-with-ajax-enabled/">How to implement action caching in ruby on rails with ajax enabled</a></h1>
        <span>
            Posted by <a href="http://codebeerstartups.com" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2013-02-08">February 8, 2013</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">

        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					optimization
          		
					performance
          		
					quick-solution
          		
					tips-and-tricks
          		
            </h2>
            <h1 id="posttitle"><a href="#">How to implement action caching in ruby on rails with ajax enabled</a></h1>
            <span>
                Posted by <a href="" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2013-02-08">February 8, 2013</time>.
            </span>
        </header>

        <section class="postbody">
            <p>As a ruby on rails developer you can implement caching pretty fast. As all we know there are three kind of caching</p>

<ul>
  <li>Page Caching</li>
  <li>Action Caching</li>
  <li>Fragment caching</li>
</ul>

<p><!--more--></p>

<p>So here is the major difference in three type of caching and then lets just implement action_caching in just few lines.</p>

<ul>
  <li><strong>Page Caching</strong> -&gt; An html page will be saved in your public directory. No before filters etc will be triggered once page is cached</li>
  <li><strong>Action Caching</strong> -&gt;  Its more or less same like page caching but before_filters will be executed in this case and thats the best part of it.</li>
  <li><strong>Fragment caching</strong> -&gt; It will be used in the case when you want to cache a specific segment of a page like sidebar etc.</li>
</ul>

<p>Ok. Lets move to action caching in ruby on rails and you can enable caching by setting perform_caching true in development environment</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">action_controller</span><span class="o">.</span><span class="n">perform_caching</span> <span class="o">=</span> <span class="kp">true</span></code></pre></div>

<p>Lets cache index action of products controller. You can do that by specify this line in you controller:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span></code></pre></div>

<p>Pretty easy :)</p>

<h2 id="case-1">Case 1:</h2>

<p>You have pagination implemented on this index action and you want to cache different pages. Pretty easy:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:cache_path</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span> <span class="p">}</span></code></pre></div>

<h2 id="case-2">Case 2:</h2>

<p>You have pagination implemented on this index action and you want to cache different pages. But not for logged in user. You want to cache only for logged out users.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:unless</span> <span class="o">=&gt;</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:cache_path</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span> <span class="p">}</span></code></pre></div>

<p><em>(I am using devise so current_user method is there. Make sure you have current_user method)</em></p>

<h2 id="case-3">Case 3:</h2>

<p>You have pagination implemented on this index action and you want to cache different pages. But not for logged in user. You want to cache only for logged out users and you want to expire this cache in every 10 mins.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:unless</span> <span class="o">=&gt;</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:cache_path</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span> <span class="p">},</span><span class="ss">:expires_in</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="o">.</span><span class="n">minutes</span></code></pre></div>

<h2 id="case-4">Case 4:</h2>

<p>Sometimes we want to reject a specific parameter may some query string parameters, so you can do:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:unless</span> <span class="o">=&gt;</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:cache_path</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">except</span><span class="p">(</span><span class="ss">:reject_this_specific_parameter</span><span class="p">)},</span><span class="ss">:expires_in</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="o">.</span><span class="n">minutes</span></code></pre></div>

<h2 id="case-5">Case 5:</h2>

<p>Cache ajax and html request both. Before we check how to do that. Lets talk about ajax. We all know how to implement ajax requests in ruby on rails ie remote =&gt; true in the link_to method. But so far I am not able to figure out how to do action caching when its enabled. So its a little bit jack I have posted a question on <a href="http://stackoverflow.com/q/13635548/179855">stackoverflow</a>, but not getting any solution for that. If you know please let me and i will update this post ;)</p>

<p>So paste this code in your application.js (You may want to bind it as a live event, But I am leaving it upto you.)</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.pagination a&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;script&#39;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>And in controller:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">cache_path</span><span class="p">:</span> <span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">except</span><span class="p">(</span><span class="ss">:_</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">format</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">format</span><span class="p">)}</span></code></pre></div>

<p>So thats all about the action caching in ruby on rails with params options. Make sure you follow all the railscasts to implement caching in a better way because there are lot of things you need to take care in case of caching. Also there are sweepers which can help you to clear cache as per the events instead of just time based.</p>

<p>One last thing. To clear cache in development mode you can Rails.cache.clear from console. :) and also take a look how to <a href="http://www.codebeerstartups.com/2013/01/quick-way-to-setup-memcached-in-Ruby on Rails-application/" title="Quick way to setup memcached in Ruby on Rails application">setup memcached in ruby on rails</a></p>

<p>You can read in detail about all of these from <a href="http://guides.rubyonrails.org/caching_with_rails.html" title="Caching in ruby on rails">rails guides</a> and there are so many <a href="http://railscasts.com/episodes?search=caching" title="Caching in ruby on rails">railscasts there on the same topic ie caching in ruby on rails</a></p>


        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=How to implement action caching in ruby on rails with ajax enabled&url=http://codebeerstartups.com/2013/02/how-to-implement-action-caching-in-ruby-on-rails-with-ajax-enabled/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://codebeerstartups.com/2013/02/how-to-implement-action-caching-in-ruby-on-rails-with-ajax-enabled/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/author.jpg" class="author" alt="user">
            <div class="info">
                <h4>Mohit Jain</h4>
                <a href="http://codebeerstartups.com">http://codebeerstartups.com</a>
                <p>Rails Developer</p>
                <ul class="social">
       				
                    <li><a href="http://twitter.com/jainmohit27" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="http://facebook.com/jain.mohit27" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="http://github.com/mohitjain" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
					
					
                    <li><a href="https://plus.google.com/+MohitJain27" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
					
					
					
                    <li><a href="https://www.pinterest.com/mohitjain27/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/profile/view?id=40603170" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="http://codebeerstartups.com/feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>


        <div class="comments">
            <a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
            <div id="disqus_thread"></div>
            <div id="g-comments"></div>
        </div>

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about.html">About</a> &bull;
        
        	
        
        	<a href="/contact.html">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>