<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>Better way to parse user info from omniauth hash</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/2013/07/better-way-to-parse-user-info-from-omniauth-hash/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            <li><a href="/contact/">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="index">
    <div class="wrapper">
        <h1 class="right">Better way to parse user info from omniauth hash</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/author.jpg" class="profileimage" alt="user">
    <h4>Mohit Jain</h4>
    <ul>
    	
        <li><a href="http://twitter.com/jainmohit27" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="http://facebook.com/jain.mohit27" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="http://github.com/mohitjain" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="http://codebeerstartups.com/feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>Rails Developer</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				omniauth
          	
				facebook
          	
				ruby
          	
				ruby-on-rails
          	
        </h2>
        <h1><a href="/2013/07/better-way-to-parse-user-info-from-omniauth-hash/">Better way to parse user info from omniauth hash</a></h1>
        <span>
            Posted by <a href="http://codebeerstartups.com" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2013-07-10">July 10, 2013</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">

        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					omniauth
          		
					facebook
          		
					ruby
          		
					ruby-on-rails
          		
            </h2>
            <h1 id="posttitle"><a href="#">Better way to parse user info from omniauth hash</a></h1>
            <span>
                Posted by <a href="" target="_blank">Mohit Jain</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2013-07-10">July 10, 2013</time>.
            </span>
        </header>

        <section class="postbody">
            <p>Lets assume we have to parse this hash. There can be case we are not getting the keys as a response. So this post is about handling those cases.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:provider</span> <span class="o">=&gt;</span> <span class="s1">'facebook'</span><span class="p">,</span>
  <span class="ss">:uid</span> <span class="o">=&gt;</span> <span class="s1">'1234567'</span><span class="p">,</span>
  <span class="ss">:info</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:nickname</span> <span class="o">=&gt;</span> <span class="s1">'jbloggs'</span><span class="p">,</span>
    <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s1">'joe@bloggs.com'</span><span class="p">,</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Joe Bloggs'</span><span class="p">,</span>
    <span class="ss">:first_name</span> <span class="o">=&gt;</span> <span class="s1">'Joe'</span><span class="p">,</span>
    <span class="ss">:last_name</span> <span class="o">=&gt;</span> <span class="s1">'Bloggs'</span><span class="p">,</span>
    <span class="ss">:image</span> <span class="o">=&gt;</span> <span class="s1">'http://graph.facebook.com/1234567/picture?type=square'</span><span class="p">,</span>
    <span class="ss">:urls</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:Facebook</span> <span class="o">=&gt;</span> <span class="s1">'http://www.facebook.com/jbloggs'</span> <span class="p">},</span>
    <span class="ss">:location</span> <span class="o">=&gt;</span> <span class="s1">'Palo Alto, California'</span><span class="p">,</span>
    <span class="ss">:verified</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="p">},</span>
  <span class="ss">:credentials</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="s1">'ABCDEF...'</span><span class="p">,</span> <span class="c1"># OAuth 2.0 access_token, which you may wish to store</span>
    <span class="ss">:expires_at</span> <span class="o">=&gt;</span> <span class="mi">1321747205</span><span class="p">,</span> <span class="c1"># when the access token expires (it always will)</span>
    <span class="ss">:expires</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="c1"># this will always be true</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<!--more-->

<h2 id="general-scenario">General Scenario</h2>

<p>So in the best case scenario we will be having all the keys. So the code like this will work.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="n">user_email</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:email</span><span class="p">]</span>
	<span class="n">user_nickname</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:nickname</span><span class="p">]</span>
	<span class="n">user_location</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:location</span><span class="p">]</span></code></pre></figure>

<h2 id="exceptional-scenario">Exceptional Scenario</h2>

<p>Now think about this case when we donâ€™t have location key in the response. So we got an hash like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
	  <span class="ss">:provider</span> <span class="o">=&gt;</span> <span class="s1">'facebook'</span><span class="p">,</span>
	  <span class="ss">:uid</span> <span class="o">=&gt;</span> <span class="s1">'1234567'</span><span class="p">,</span>
	  <span class="ss">:info</span> <span class="o">=&gt;</span> <span class="p">{</span>
	    <span class="ss">:nickname</span> <span class="o">=&gt;</span> <span class="s1">'jbloggs'</span><span class="p">,</span>
	    <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s1">'joe@bloggs.com'</span><span class="p">,</span>
	    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Joe Bloggs'</span><span class="p">,</span>
	    <span class="ss">:first_name</span> <span class="o">=&gt;</span> <span class="s1">'Joe'</span><span class="p">,</span>
	    <span class="ss">:last_name</span> <span class="o">=&gt;</span> <span class="s1">'Bloggs'</span><span class="p">,</span>
	    <span class="ss">:image</span> <span class="o">=&gt;</span> <span class="s1">'http://graph.facebook.com/1234567/picture?type=square'</span><span class="p">,</span>
	    <span class="ss">:urls</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:Facebook</span> <span class="o">=&gt;</span> <span class="s1">'http://www.facebook.com/jbloggs'</span> <span class="p">},</span>
	    <span class="ss">:verified</span> <span class="o">=&gt;</span> <span class="kp">true</span>
	  <span class="p">},</span>
	  <span class="ss">:credentials</span> <span class="o">=&gt;</span> <span class="p">{</span>
	    <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="s1">'ABCDEF...'</span><span class="p">,</span> <span class="c1"># OAuth 2.0 access_token, which you may wish to store</span>
	    <span class="ss">:expires_at</span> <span class="o">=&gt;</span> <span class="mi">1321747205</span><span class="p">,</span> <span class="c1"># when the access token expires (it always will)</span>
	    <span class="ss">:expires</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="c1"># this will always be true</span>
	  <span class="p">}</span>
	<span class="p">}</span></code></pre></figure>

<!--more-->

<p>Now in this case</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user_email</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:email</span><span class="p">]</span>   <span class="c1"># will work</span>
<span class="n">user_nickname</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:nickname</span><span class="p">]</span> <span class="c1"># will work</span>
<span class="n">user_location</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:location</span><span class="p">]</span> <span class="c1"># will return nil here...</span></code></pre></figure>

<p>As we all know there is no surety of the hash from the provider so we cant trust it and this â€˜nilâ€™ value can later on create issues as we start using it assuming everything is coming perfectly fine from provider.</p>

<p>So if you want to generate an error in this case when key is not found a simple way can be using statement modifiers ie</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">][</span><span class="ss">:location</span><span class="p">]</span> <span class="n">or</span> <span class="k">raise</span> <span class="no">ArgumentError</span>
<span class="c1"># =&gt; example.rb:23:in `&lt;main&gt;': ArgumentError (ArgumentError)</span></code></pre></figure>

<p>but there is a better way ie <strong> using â€˜fetchâ€™ </strong></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">].</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:location</span><span class="p">)</span> <span class="o">/</span><span class="sr">/ this will throw an error
 # =&gt;  example.rb:23:in `fetch': key not found: :location (KeyError) from example.rb:23:in `&lt;main&gt;'</span></code></pre></figure>

<p>If you are not sure even for info part (which actually you canâ€™t be) then you can chain ie like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">auth</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:info</span><span class="p">).</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:location</span><span class="p">)</span></code></pre></figure>

<h2 id="use-case-1---providing-a-default-value">Use case 1 - Providing a default value</h2>

<p>Now if you want to pass a block for a default value which will be executed if and only if that key is not valuated.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">].</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:location</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"India"</span> <span class="p">}</span>
<span class="c1"># =&gt; "India"</span></code></pre></figure>

<h2 id="use-case-2---passing-a-block">Use case 2 - Passing a block</h2>

<p>Another use case of fetch is it yields the missing key which can be used as</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">default</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is missing "</span>
<span class="k">end</span>

<span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">].</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:location</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">default</span><span class="p">)</span></code></pre></figure>

<h2 id="caution">Caution</h2>

<p>Another thing to note with fetch is, there is another way to pass second parameter is method ie:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">default</span>
	<span class="s2">"This is my default value"</span>
<span class="k">end</span>

<span class="n">auth</span><span class="p">[</span><span class="ss">:info</span><span class="p">].</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:location</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></code></pre></figure>

<p>But the problem with second one is default method. This method will be computed everytime wheather your key exists or not, which can be a problem in case you are doing some heavy computation. Using block will execute if and only if key doesnâ€™t exists.</p>

<h2 id="fetch-also-works-on-arrays">Fetch also works on arrays</h2>

<p>Another thing to note down is fetch also works on array as it works on hash</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">'c'</span><span class="p">,</span><span class="s1">'d'</span><span class="p">]</span>

<span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># =&gt; nil</span>
<span class="n">a</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># =&gt; example.rb:39:in `fetch': index 10 outside of array bounds: -4...4 (IndexError) from example.rb:39:in `&lt;main&gt;'</span></code></pre></figure>

<p>Thats all :)</p>


        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=Better way to parse user info from omniauth hash&url=http://codebeerstartups.com/2013/07/better-way-to-parse-user-info-from-omniauth-hash/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://codebeerstartups.com/2013/07/better-way-to-parse-user-info-from-omniauth-hash/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/author.jpg" class="author" alt="user">
            <div class="info">
                <h4>Mohit Jain</h4>
                <a href="http://codebeerstartups.com">http://codebeerstartups.com</a>
                <p>Rails Developer</p>
                <ul class="social">
       				
                    <li><a href="http://twitter.com/jainmohit27" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="http://facebook.com/jain.mohit27" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="http://github.com/mohitjain" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
					
					
                    <li><a href="https://plus.google.com/+MohitJain27" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
					
					
					
                    <li><a href="https://www.pinterest.com/mohitjain27/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/profile/view?id=40603170" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="http://codebeerstartups.com/feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>


        <div class="comments">
            <a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
            <div id="disqus_thread"></div>
            <div id="g-comments"></div>
        </div>

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	<a href="/contact/">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>