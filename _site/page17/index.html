<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>Codebeerstartups</title>
      <meta name="description" content="Every Dog has one Blog" />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="http://codebeerstartups.com/feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="http://codebeerstartups.com">
      <link rel="canonical" href="http://codebeerstartups.com/page17/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="http://codebeerstartups.com"><i class="fa fa-bookmark-o fa-lg"></i><span>Codebeerstartups</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            <li><a href="/contact/">Contact</a></li>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
</nav>

    <div class="profile">
	
	<h4>Codebeerstartups</h4>
	<p>Every Dog has one Blog</p>
	<hr>
</div>

<section class="posts postindex wrapper">

	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					optimization 
					
					quick-solution 
					
					tips-and-tricks 
					
					utilities 
					
				</h2>
				<h1><a href="/2012/11/pagination-with-ajax-using-will-paginate-in-ruby-on-rails/">Pagination with ajax using will paginate in ruby on rails</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-11-27">November 27, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>Just learned this trick. Super awesome. You want to enable ajax based pagination with will_paginate within just two mins? Yes.. He is small tip.</p>

<p>I am assuming you have a index page having basic table for now. Here are steps:</p>

<ul>
  <li>Make a partial for the value tbody section.</li>
  <li>Enable format.js in controller</li>
  <li>Create a file ie index.js.erb. Paste some basic code there.</li>
  <li>Paste a small code in index.html.erb</li>
  <li>And its done :)</li>
</ul>

<h2 id="code">Code:</h2>

<h2 id="productscontroller">products_controller</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">index</span>
  <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">paginate</span><span class="p">(</span><span class="ss">:order</span> <span class="o">=&gt;</span><span class="s2">"name ASC"</span> <span class="p">,</span><span class="ss">:page</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">],</span> <span class="ss">:per_page</span> <span class="o">=&gt;</span> <span class="mi">14</span><span class="p">)</span>
  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="c1"># index.html.erb</span>
    <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@products</span> <span class="p">}</span>
    <span class="nb">format</span><span class="p">.</span><span class="nf">js</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<h2 id="indexhtmlerb">index.html.erb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="no">Products</span><span class="o">&lt;</span><span class="sr">/h1&gt;
&lt;div id="products"&gt;
	&lt;%= render "products/</span><span class="n">products</span><span class="s2">" %&gt;
&lt;/div&gt;
&lt;script&gt;
$(function(){
   $('.pagination a').attr('data-remote', 'true')
});
&lt;/script&gt;</span></code></pre></figure>

<h2 id="indexjserb">index.js.erb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jQuery</span><span class="p">(</span><span class="s1">'#products'</span><span class="p">).</span><span class="nf">html</span><span class="p">(</span><span class="s2">" 'products/products' )%&gt;"</span><span class="p">);</span>
<span class="err">$</span><span class="p">(</span><span class="s1">'.pagination a'</span><span class="p">).</span><span class="nf">attr</span><span class="p">(</span><span class="s1">'data-remote'</span><span class="p">,</span> <span class="s1">'true'</span><span class="p">);</span></code></pre></figure>

<h2 id="productshtmlerb">_products.html.erb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">"listing"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">% @products.each </span><span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="sx">%&gt;
        &lt;div&gt;</span>
	   <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="sx">%= product.title %&gt; &lt;/span&gt;
           &lt;span&gt; &lt;%=</span> <span class="n">product</span><span class="p">.</span><span class="nf">price</span> <span class="sx">%&gt;  &lt;/span&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div&gt;
     &lt;% end %&gt;
&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">%= will_paginate @products %&gt;</span></code></pre></figure>

<p>Thats all. So just enabling format.js a partial and some javascript, ajax based pagination is done.</p>
   
					
				</div>
			</header>
		</article>
	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					optimization 
					
					performance 
					
					quick-solution 
					
					Server 
					
					tips-and-tricks 
					
				</h2>
				<h1><a href="/2012/11/use-after_commit-instead-of-active-record-callbacks-to-avoid-unexpected-errors/">Use after_commit instead of active record callbacks to avoid unexpected errors</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-11-26">November 26, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>AR callbacks after_create/after_update/after_destroy to generate background job etc are useful, but these callbacks are still wrapped in database transaction, and you may probably get unexpected errors on production servers.</p>

<h2 id="before">Before</h2>
<p>It’s common to generate a background job to send emails like</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">after_create</span> <span class="ss">:asyns_send_notification</span>
  <span class="k">def</span> <span class="nf">async_send_notification</span>
    <span class="no">Notifier</span><span class="p">.</span><span class="nf">send_new_comment_notification</span><span class="p">(</span><span class="nb">self</span><span class="p">).</span><span class="nf">deliver</span>
  <span class="k">end</span>
 <span class="n">handle_asynchronously</span> <span class="ss">:async_send_notification</span>
<span class="k">end</span>

<span class="c1"># It looks fine that comment record passed to delayed job and then delayed job will fetch this</span>
<span class="c1">#comment and then post on which this comment has been made and a notification will</span>
<span class="c1">#send via email to the author of that post. Right?</span></code></pre></figure>

<p>You won’t see any issue in development, as local db can commit fast. But in production server, db traffic might be huge, worker probably finish faster than transaction commit. e.g</p>

<ol>
  <li>main process</li>
  <li>worker process</li>
  <li>BEGIN</li>
</ol>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">INSERT</span> <span class="n">comment</span> <span class="k">in</span> <span class="n">comments</span> <span class="n">table</span>
<span class="c1"># return id 10 for newly-created notification</span>
<span class="no">SELECT</span> <span class="o">*</span> <span class="no">FROM</span> <span class="n">notifications</span> <span class="no">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">10</span>
<span class="no">COMMIT</span></code></pre></figure>

<p>In this case, the worker process query the newly-created notification before main process commits the transaction, it will raise NotFoundError, because transaction in worker process can’t read uncommitted notification from transaction in main process.</p>

<h2 id="refactor">Refactor</h2>

<p>So we should tell activerecord to generate notification worker after notification insertion transaction committed.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">after_commit</span> <span class="ss">:asyns_send_notification</span><span class="p">,</span><span class="ss">:on</span> <span class="o">=&gt;</span> <span class="ss">:create</span>  <span class="c1"># This is the main point of the whole thing.</span>

  <span class="k">def</span> <span class="nf">async_send_notification</span>
    <span class="no">Notifier</span><span class="p">.</span><span class="nf">send_new_comment_notification</span><span class="p">(</span><span class="nb">self</span><span class="p">).</span><span class="nf">deliver</span>
  <span class="k">end</span>
  <span class="n">handle_asynchronously</span> <span class="ss">:async_send_notification</span>
<span class="k">end</span></code></pre></figure>

<p>Now the transactions order becomes</p>

<ol>
  <li>main process</li>
  <li>worker process</li>
  <li>BEGIN</li>
</ol>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">INSERT</span> <span class="n">comment</span> <span class="n">into</span> <span class="n">comments_table</span>
<span class="k">return</span> <span class="nb">id</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">newly</span><span class="o">-</span><span class="n">created</span> <span class="n">notification</span>
<span class="no">COMMIT</span>
<span class="no">SELECT</span> <span class="o">*</span> <span class="no">FROM</span> <span class="n">notifications</span> <span class="no">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">10</span></code></pre></figure>

<p>Worker process won’t receive NotFoundErrors any more. :)</p>
   
					
				</div>
			</header>
		</article>
	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					optimization 
					
					performance 
					
					quick-solution 
					
					tips-and-tricks 
					
				</h2>
				<h1><a href="/2012/11/track-changes-in-your-active-record-object-using-dirty-objects-in-rails/">Track changes in your active record object using Dirty Objects in Rails</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-11-25">November 25, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>If you want to track whether your active record objects have been modified or not. It becomes a lot easier with the dirty object functionality. Its pretty simple and clean.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">first</span>
<span class="n">article</span><span class="p">.</span><span class="nf">changed?</span>  <span class="c1">#=&gt; false</span>

<span class="c1"># Track changes to individual attributes with# attr_name_changed? accessor</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title</span>  <span class="c1">#=&gt; "Title"</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s2">"New Title"</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title_changed?</span> <span class="c1">#=&gt; true</span>

<span class="c1"># Access previous value with attr_name_was accessor</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title_was</span>  <span class="c1">#=&gt; "Title"</span>

<span class="c1"># See both previous and current value with attr_name_change accessor</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title_change</span>  <span class="c1">#=&gt; ["Title", "New Title"]</span></code></pre></figure>

<p>You can also query to object directly for its list of all changed attributes.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Get a list of changed attributes</span>
<span class="n">article</span><span class="p">.</span><span class="nf">changed</span>  <span class="c1">#=&gt; ['title']</span>
<span class="c1"># Get the hash of changed attributes and their previous and current values</span>
<span class="n">article</span><span class="p">.</span><span class="nf">changes</span>  <span class="c1">#=&gt; { 'title' =&gt; ["Title", "New Title"] }</span></code></pre></figure>

<p>Once you save a dirty object it clears out its changed state tracking and is once again considered unchanged.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">article</span><span class="p">.</span><span class="nf">changed?</span>  <span class="c1">#=&gt; true</span>
<span class="n">article</span><span class="p">.</span><span class="nf">save</span>  <span class="c1">#=&gt; truearticle.changed?  #=&gt; false</span></code></pre></figure>

<p>If you’re going to be modifying an attribute outside of the attr= writer, you can use attr_name_will_change! to tell the object to be aware of the change:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">first</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title_will_change!</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">.</span><span class="nf">upcase!</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title_change</span>  <span class="c1">#=&gt; ['Title', 'TITLE']</span></code></pre></figure>

   
					
				</div>
			</header>
		</article>
	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					General 
					
					quick-solution 
					
					tips-and-tricks 
					
				</h2>
				<h1><a href="/2012/11/interpolate-text-quickly-in-ruby/">Interpolate text quickly in ruby</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-11-25">November 25, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>You could store a format string:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_string</span> <span class="o">=</span> <span class="s2">"Congrats, you have joined %s"</span>
<span class="n">group_name</span> <span class="o">=</span> <span class="s2">"My Group"</span>
<span class="nb">puts</span> <span class="n">my_string</span> <span class="o">%</span> <span class="n">group_name</span> <span class="c1"># prints: Congrats, you have joined My Group</span></code></pre></figure>

<p>For multiple variables in the same string you can use</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_string</span> <span class="o">=</span> <span class="s2">"Congrats, you have joined %s and %s"</span>
<span class="n">group_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'group1'</span><span class="p">,</span> <span class="s1">'group2'</span><span class="p">]</span>
<span class="nb">puts</span> <span class="n">my_string</span> <span class="o">%</span> <span class="p">[</span><span class="s1">'group1'</span><span class="p">,</span> <span class="s1">'group2'</span><span class="p">]</span>  <span class="c1"># prints: Congrats, you have joined group1 and group2</span></code></pre></figure>

<p>A nice to Interpolate text quickly in ruby.</p>
   
					
				</div>
			</header>
		</article>
	
		<article class="post ">
			<header>
				<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
				<h2>
					
					Server 
					
				</h2>
				<h1><a href="/2012/11/configure-time-zones-for-your-debian-based-server/">Configure time zones for your debian based server</a></h1>
				<span>
					Posted on <i class="fa fa-clock-o"></i><time datetime="2012-11-25">November 25, 2012</time>.
				</span>
				<div class="excerpt">
					
						<p>Rails always stores your dates in UTC in the database (unless you change a different setting). You can configure time zones for your debian based server just by running this command:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">sudo</span> <span class="n">dpkg</span><span class="o">-</span><span class="n">reconfigure</span> <span class="n">tzdata</span>
<span class="c1"># for India, select Asia and then select Kolkata</span></code></pre></figure>

   
					
				</div>
			</header>
		</article>
	

	<div class="pagination">
	
		<a href="/page18" class="smallbutton lightgray left"><i class="fa fa-chevron-left"></i><span>Older Posts</span></a>
	
	
		<a href="/page16" class="smallbutton lightgray right"><span>Newer Posts</span><i class="fa fa-chevron-right"></i></a>
	
</div>

</section>

    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	<a href="/contact/">Contact</a> &bull;
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="http://codebeerstartups.com/">Codebeerstartups</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': 'codebeerstartups',
        'google_comments': false,
        'analytics_id': 'UA-30450850-3',
        'analytics_domain': 'codebeerstartups.com',
        'readingtime': true,
        'autoload_comments': true
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.min.js"></script>

  </body>
</html>